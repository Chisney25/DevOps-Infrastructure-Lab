name: DevOps Compliance & Script Audit

on:
  push:
    branches: [ "main" ]

jobs:
  devops-test:
    runs-on: ubuntu-latest
    steps:
      - name: ğŸ“¥ Checkout Code
        uses: actions/checkout@v4

      - name: ğŸ›¡ï¸ Check Documentation Compliance
        run: |
          if grep -q "RBAC" environment-strategy.md; then
            echo "âœ… Security docs verified."
          else
            echo "âŒ Missing RBAC documentation!"
            exit 1
          fi

      - name: ğŸ§ Lint Bash Script
        run: |
          echo "Testing system_health.sh for syntax errors..."
          bash -n scripts/system_health.sh
          echo "âœ… Bash syntax is clean."

      - name: ğŸ› ï¸ Simulate Script Execution
        run: |
          chmod +x scripts/system_health.sh
          # We use 'mock' data or check-only mode in CI
          bash scripts/system_health.sh || echo "Script ran with warnings but passed."
